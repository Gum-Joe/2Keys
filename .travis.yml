language: node_js
node_js:
  - lts/*
  - node

os: windows

# Fix build timeout. See https://travis-ci.community/t/build-timeout-but-actually-succeeded/2763
env:
  - YARN_GPG=no

cache:
  npm: true
  yarn: true
  directories:
    - .build-cache # Cache build
# Default is fine here
before_install:
  # Convery lock file
  - choco install yarn
install:
  - "\"/c/Program Files (x86)/Yarn/bin/yarn\" --frozen-lockfile"
before_script:
  - yarn build -v
  - yarn workspace @twokeys/server run ts-node ./scripts/bootstrap.ts
# NB: server tests ran separately as they assume the CWD is the server package
script:
  - yarn coverage:all
  - bash <(curl -s https://codecov.io/bash)
